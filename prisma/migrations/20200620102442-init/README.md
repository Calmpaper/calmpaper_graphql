# Migration `20200620102442-init`

This migration has been generated by ignatif at 6/20/2020, 10:24:42 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."User" (
"avatar" text   ,"email" text   ,"id" SERIAL,"username" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Book" (
"authorUsername" text   ,"description" text  NOT NULL ,"id" SERIAL,"image" text   ,"name" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Chapter" (
"authorUsername" text   ,"bookId" integer   ,"content" text  NOT NULL ,"id" SERIAL,"image" text   ,"title" text   ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Voice" (
"authorUsername" text   ,"bookId" integer   ,"chapterId" integer   ,"id" SERIAL,"url" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Rating" (
"authorUsername" text   ,"bookId" integer   ,"chapterId" integer   ,"id" SERIAL,"stars" integer  NOT NULL ,"userUsername" text   ,"voiceId" integer   ,
    PRIMARY KEY ("id"))

CREATE UNIQUE INDEX "User.username" ON "public"."User"("username")

CREATE UNIQUE INDEX "User.email" ON "public"."User"("email")

ALTER TABLE "public"."Book" ADD FOREIGN KEY ("authorUsername")REFERENCES "public"."User"("username") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Chapter" ADD FOREIGN KEY ("authorUsername")REFERENCES "public"."User"("username") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Chapter" ADD FOREIGN KEY ("bookId")REFERENCES "public"."Book"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Voice" ADD FOREIGN KEY ("authorUsername")REFERENCES "public"."User"("username") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Voice" ADD FOREIGN KEY ("bookId")REFERENCES "public"."Book"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Voice" ADD FOREIGN KEY ("chapterId")REFERENCES "public"."Chapter"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Rating" ADD FOREIGN KEY ("authorUsername")REFERENCES "public"."User"("username") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Rating" ADD FOREIGN KEY ("userUsername")REFERENCES "public"."User"("username") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Rating" ADD FOREIGN KEY ("bookId")REFERENCES "public"."Book"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Rating" ADD FOREIGN KEY ("chapterId")REFERENCES "public"."Chapter"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Rating" ADD FOREIGN KEY ("voiceId")REFERENCES "public"."Voice"("id") ON DELETE SET NULL  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200620102442-init
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,77 @@
+generator client {
+  provider = "prisma-client-js"
+}
+
+datasource db {
+  provider = "postgresql"
+  url      = "postgres://wzuflgpoeieulz:298ce98959a43d5d531f61be338c8f4df5ed1191b99b339130120eae6e14e9c2@ec2-3-229-210-93.compute-1.amazonaws.com:5432/d3m8dkmbvffsnd"
+}
+
+
+model User {
+  id             Int        @default(autoincrement()) @id
+  username       String     @unique
+  email          String?    @unique
+  avatar         String?
+  books          Book[]
+  chapters       Chapter[]
+  voices         Voice[]
+  ratings        Rating[]   @relation("RatingAuthor")
+  settedRetings  Rating[]   @relation("RatingTarget")
+}
+
+model Book {
+  id             Int        @default(autoincrement()) @id
+  name           String
+  description    String
+  image          String?
+
+  author         User?      @relation(fields: [authorUsername], references: [username])
+  authorUsername String?
+  chapters       Chapter[]
+  voices         Voice[]
+  ratings        Rating[]
+}
+
+model Chapter {
+  id             Int        @default(autoincrement()) @id
+  title          String?
+  content        String
+  image          String?
+
+  author         User?      @relation(fields: [authorUsername], references: [username])
+  authorUsername String?
+  book           Book?      @relation(fields: [bookId], references: [id])
+  bookId         Int?
+  voices         Voice[]
+  ratings        Rating[]
+}
+
+model Voice {
+  id             Int        @default(autoincrement()) @id
+  url            String
+
+  author         User?      @relation(fields: [authorUsername], references: [username])
+  authorUsername String?
+  book           Book?      @relation(fields: [bookId], references: [id])
+  bookId         Int?
+  chapter        Chapter?   @relation(fields: [chapterId], references: [id])
+  chapterId      Int?
+  ratings        Rating[]
+}
+
+model Rating {
+  id             Int        @default(autoincrement()) @id
+  stars          Int
+
+  author         User?      @relation(name: "RatingAuthor", fields: [authorUsername], references: [username])
+  authorUsername String?
+  user           User?      @relation(name: "RatingTarget", fields: [userUsername], references: [username])
+  userUsername   String?
+  book           Book?      @relation(fields: [bookId], references: [id])
+  bookId         Int?
+  chapter        Chapter?   @relation(fields: [chapterId], references: [id])
+  chapterId      Int?
+  voice          Voice?     @relation(fields: [voiceId], references: [id])
+  voiceId        Int?
+}
```


